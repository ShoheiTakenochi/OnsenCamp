<div class="mb-4 p-4">
  <%= search_form_for @q, url: campsites_path, method: :get do |f| %>
    <div class="flex items-center space-x-2">
      <%= f.search_field :name_cont, placeholder:"キャンプ場名", class: "border p-2 rounded-md" %>
      <%= f.search_field :address_cont, placeholder:"住所", class: "border p-2 rounded-md" %>
      <%= f.submit "検索", class: "bg-[#84A08E] text-white px-4 py-2 rounded-md" %>
    </div>
  <% end %>
</div>

<div id="map" style="height: 600px; width: 100%;"></div>

<script>
  function initMap() {
    const map = new google.maps.Map(document.getElementById("map"), {
      center: { lat: 35.6895, lng: 139.6917 }, // 東京
      zoom: 10,
    });

    <% @campsites.each do |campsite| %>
      new google.maps.Marker({
        position: { lat: <%= campsite.latitude %>, lng: <%= campsite.longitude %> },
        map: map,
        title: "<%= campsite.name %>"
      });
    <% end %>
  }

  document.addEventListener("DOMContentLoaded", function() {
    const script = document.createElement("script");
    script.src = `https://maps.googleapis.com/maps/api/js?key=<%= ENV['GOOGLE_MAPS_API_KEY'] %>&callback=initMap`;
    script.defer = true;
    document.head.appendChild(script);
  });
</script>
